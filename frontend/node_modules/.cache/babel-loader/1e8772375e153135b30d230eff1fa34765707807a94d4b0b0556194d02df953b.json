{"ast":null,"code":"import axios from \"axios\";\nimport Cookies from \"js-cookie\";\nexport const refreshTokens = async () => {\n  const refresh = Cookies.get(\"refresh\");\n  if (!refresh) return console.warn(\"Refresh token отсутствует!\") || false;\n  try {\n    const {\n      data\n    } = await axios.post(\"http://localhost:8000/api/auth/token/\", {\n      refresh\n    });\n    Cookies.set(\"access\", data.access, {\n      expires: 15 / 1440,\n      // secure: true,\n      sameSite: \"Lax\"\n    });\n    Cookies.set(\"refresh\", data.refresh, {\n      expires: 30,\n      // secure: true,\n      sameSite: \"Lax\"\n    });\n    window.location.reload();\n    return true;\n  } catch (err) {\n    return false;\n  }\n};\nexport const fetchData = async (url, method, data = null, setResponse = null, setFetchError = null, setFetchSuccess = null, isFileDownload = false,\n// Флаг для скачивания файлов\nfileName = \"download.csv\" // Имя файла по умолчанию\n) => {\n  let access = Cookies.get(\"access\");\n  try {\n    const response = await axios({\n      method,\n      url: `http://localhost:8000/api/${url}`,\n      data,\n      headers: {\n        Authorization: `Bearer ${access}`,\n        \"Content-Type\": isFileDownload ? 'multipart/form-data' : \"application/json\"\n      },\n      responseType: isFileDownload ? \"blob\" : \"json\" // blob для скачивания файлов\n    });\n    if (isFileDownload) {\n      // Создаём ссылку на файл и автоматически скачиваем\n      const url = window.URL.createObjectURL(new Blob([response.data]));\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = fileName;\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      window.URL.revokeObjectURL(url);\n    } else {\n      setResponse === null || setResponse === void 0 ? void 0 : setResponse(response.data);\n      setFetchSuccess === null || setFetchSuccess === void 0 ? void 0 : setFetchSuccess(response.data.message);\n    }\n  } catch (error) {\n    if (error.response) {\n      const fetchError = error.response.data.detail || \"Ошибка сервера.\";\n      console.error(\"Ошибка ответа:\", error.response.data);\n      setFetchError === null || setFetchError === void 0 ? void 0 : setFetchError(fetchError);\n      if (fetchError === \"Authentication credentials were not provided.\") {\n        console.warn(\"Токен истёк. Попытка обновить токен...\");\n        await refreshTokens();\n      }\n    } else {\n      console.error(\"Ошибка сети или сервера:\", error.message);\n      setFetchError === null || setFetchError === void 0 ? void 0 : setFetchError(\"Ошибка сети или сервера.\");\n    }\n  }\n};","map":{"version":3,"names":["axios","Cookies","refreshTokens","refresh","get","console","warn","data","post","set","access","expires","sameSite","window","location","reload","err","fetchData","url","method","setResponse","setFetchError","setFetchSuccess","isFileDownload","fileName","response","headers","Authorization","responseType","URL","createObjectURL","Blob","a","document","createElement","href","download","body","appendChild","click","remove","revokeObjectURL","message","error","fetchError","detail"],"sources":["C:/Users/DamsB/Desktop/302/frontend/src/utils/fetchData.js"],"sourcesContent":["import axios from \"axios\";\nimport Cookies from \"js-cookie\";\n\nexport const refreshTokens = async () => {\n\tconst refresh = Cookies.get(\"refresh\");\n\n\tif (!refresh) return console.warn(\"Refresh token отсутствует!\") || false;\n\n\ttry {\n\t\tconst { data } = await axios.post(\n\t\t\t\"http://localhost:8000/api/auth/token/\",\n\t\t\t{ refresh }\n\t\t);\n\n\t\tCookies.set(\"access\", data.access, {\n\t\t\texpires: 15 / 1440,\n\t\t\t// secure: true,\n\t\t\tsameSite: \"Lax\",\n\t\t});\n\t\tCookies.set(\"refresh\", data.refresh, {\n\t\t\texpires: 30,\n\t\t\t// secure: true,\n\t\t\tsameSite: \"Lax\",\n\t\t});\n\n\t\twindow.location.reload();\n\n\t\treturn true;\n\t} catch (err) {\n\t\treturn false;\n\t}\n};\n\nexport const fetchData = async (\n    url,\n    method,\n    data = null,\n    setResponse = null,\n    setFetchError = null,\n    setFetchSuccess = null,\n    isFileDownload = false, // Флаг для скачивания файлов\n    fileName = \"download.csv\" // Имя файла по умолчанию\n) => {\n    let access = Cookies.get(\"access\");\n\n    try {\n        const response = await axios({\n            method,\n            url: `http://localhost:8000/api/${url}`,\n            data,\n            headers: {\n                Authorization: `Bearer ${access}`,\n                \"Content-Type\": isFileDownload ? 'multipart/form-data' : \"application/json\",\n            },\n            responseType: isFileDownload ? \"blob\" : \"json\", // blob для скачивания файлов\n        });\n\n        if (isFileDownload) {\n            // Создаём ссылку на файл и автоматически скачиваем\n            const url = window.URL.createObjectURL(new Blob([response.data]));\n            const a = document.createElement(\"a\");\n            a.href = url;\n            a.download = fileName;\n            document.body.appendChild(a);\n            a.click();\n            a.remove();\n            window.URL.revokeObjectURL(url);\n        } else {\n            setResponse?.(response.data);\n            setFetchSuccess?.(response.data.message);\n        }\n    } catch (error) {\n        if (error.response) {\n            const fetchError = error.response.data.detail || \"Ошибка сервера.\";\n            console.error(\"Ошибка ответа:\", error.response.data);\n            setFetchError?.(fetchError);\n\n            if (fetchError === \"Authentication credentials were not provided.\") {\n                console.warn(\"Токен истёк. Попытка обновить токен...\");\n                await refreshTokens();\n            }\n        } else {\n            console.error(\"Ошибка сети или сервера:\", error.message);\n            setFetchError?.(\"Ошибка сети или сервера.\");\n        }\n    }\n};"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,OAAO,MAAM,WAAW;AAE/B,OAAO,MAAMC,aAAa,GAAG,MAAAA,CAAA,KAAY;EACxC,MAAMC,OAAO,GAAGF,OAAO,CAACG,GAAG,CAAC,SAAS,CAAC;EAEtC,IAAI,CAACD,OAAO,EAAE,OAAOE,OAAO,CAACC,IAAI,CAAC,4BAA4B,CAAC,IAAI,KAAK;EAExE,IAAI;IACH,MAAM;MAAEC;IAAK,CAAC,GAAG,MAAMP,KAAK,CAACQ,IAAI,CAChC,uCAAuC,EACvC;MAAEL;IAAQ,CACX,CAAC;IAEDF,OAAO,CAACQ,GAAG,CAAC,QAAQ,EAAEF,IAAI,CAACG,MAAM,EAAE;MAClCC,OAAO,EAAE,EAAE,GAAG,IAAI;MAClB;MACAC,QAAQ,EAAE;IACX,CAAC,CAAC;IACFX,OAAO,CAACQ,GAAG,CAAC,SAAS,EAAEF,IAAI,CAACJ,OAAO,EAAE;MACpCQ,OAAO,EAAE,EAAE;MACX;MACAC,QAAQ,EAAE;IACX,CAAC,CAAC;IAEFC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC;IAExB,OAAO,IAAI;EACZ,CAAC,CAAC,OAAOC,GAAG,EAAE;IACb,OAAO,KAAK;EACb;AACD,CAAC;AAED,OAAO,MAAMC,SAAS,GAAG,MAAAA,CACrBC,GAAG,EACHC,MAAM,EACNZ,IAAI,GAAG,IAAI,EACXa,WAAW,GAAG,IAAI,EAClBC,aAAa,GAAG,IAAI,EACpBC,eAAe,GAAG,IAAI,EACtBC,cAAc,GAAG,KAAK;AAAE;AACxBC,QAAQ,GAAG,cAAc,CAAC;AAAA,KACzB;EACD,IAAId,MAAM,GAAGT,OAAO,CAACG,GAAG,CAAC,QAAQ,CAAC;EAElC,IAAI;IACA,MAAMqB,QAAQ,GAAG,MAAMzB,KAAK,CAAC;MACzBmB,MAAM;MACND,GAAG,EAAE,6BAA6BA,GAAG,EAAE;MACvCX,IAAI;MACJmB,OAAO,EAAE;QACLC,aAAa,EAAE,UAAUjB,MAAM,EAAE;QACjC,cAAc,EAAEa,cAAc,GAAG,qBAAqB,GAAG;MAC7D,CAAC;MACDK,YAAY,EAAEL,cAAc,GAAG,MAAM,GAAG,MAAM,CAAE;IACpD,CAAC,CAAC;IAEF,IAAIA,cAAc,EAAE;MAChB;MACA,MAAML,GAAG,GAAGL,MAAM,CAACgB,GAAG,CAACC,eAAe,CAAC,IAAIC,IAAI,CAAC,CAACN,QAAQ,CAAClB,IAAI,CAAC,CAAC,CAAC;MACjE,MAAMyB,CAAC,GAAGC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;MACrCF,CAAC,CAACG,IAAI,GAAGjB,GAAG;MACZc,CAAC,CAACI,QAAQ,GAAGZ,QAAQ;MACrBS,QAAQ,CAACI,IAAI,CAACC,WAAW,CAACN,CAAC,CAAC;MAC5BA,CAAC,CAACO,KAAK,CAAC,CAAC;MACTP,CAAC,CAACQ,MAAM,CAAC,CAAC;MACV3B,MAAM,CAACgB,GAAG,CAACY,eAAe,CAACvB,GAAG,CAAC;IACnC,CAAC,MAAM;MACHE,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAGK,QAAQ,CAAClB,IAAI,CAAC;MAC5Be,eAAe,aAAfA,eAAe,uBAAfA,eAAe,CAAGG,QAAQ,CAAClB,IAAI,CAACmC,OAAO,CAAC;IAC5C;EACJ,CAAC,CAAC,OAAOC,KAAK,EAAE;IACZ,IAAIA,KAAK,CAAClB,QAAQ,EAAE;MAChB,MAAMmB,UAAU,GAAGD,KAAK,CAAClB,QAAQ,CAAClB,IAAI,CAACsC,MAAM,IAAI,iBAAiB;MAClExC,OAAO,CAACsC,KAAK,CAAC,gBAAgB,EAAEA,KAAK,CAAClB,QAAQ,CAAClB,IAAI,CAAC;MACpDc,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAGuB,UAAU,CAAC;MAE3B,IAAIA,UAAU,KAAK,+CAA+C,EAAE;QAChEvC,OAAO,CAACC,IAAI,CAAC,wCAAwC,CAAC;QACtD,MAAMJ,aAAa,CAAC,CAAC;MACzB;IACJ,CAAC,MAAM;MACHG,OAAO,CAACsC,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAACD,OAAO,CAAC;MACxDrB,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAG,0BAA0B,CAAC;IAC/C;EACJ;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}